# æ¶ˆè´¹è€…å¼€å§‹ä½ç½®é…ç½®æŒ‡å—

## ğŸ¯ æ¦‚è¿°

goStreamæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿæ”¯æŒä¸‰ç§ä¸åŒçš„æ¶ˆè´¹è€…å¼€å§‹ä½ç½®é…ç½®ï¼Œè®©ä½ å¯ä»¥çµæ´»æ§åˆ¶æ¶ˆè´¹è€…ä»å“ªä¸ªä½ç½®å¼€å§‹å¤„ç†æ¶ˆæ¯ã€‚

## ğŸ“‹ ä¸‰ç§å¼€å§‹ä½ç½®

### 1. ä»æœ€æ–°ä½ç½®å¼€å§‹ï¼ˆStartFromLatestï¼‰

**é»˜è®¤è¡Œä¸º**ï¼Œæ¶ˆè´¹è€…åªå¤„ç†å¯åŠ¨åå‘å¸ƒçš„æ–°æ¶ˆæ¯ï¼Œå¿½ç•¥æ‰€æœ‰å†å²æ¶ˆæ¯ã€‚

```go
// æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°ï¼ˆæ¨èï¼‰
mq := queue.NewMessageQueue(rdb, "stream", "group", "consumer")

// æ–¹å¼2ï¼šæ˜¾å¼æŒ‡å®š
mq := queue.NewMessageQueueWithStartPosition(rdb, "stream", "group", "consumer", queue.StartFromLatest)
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å®æ—¶æ¶ˆæ¯å¤„ç†
- ä¸éœ€è¦å¤„ç†å†å²æ•°æ®
- æ–°å¯åŠ¨çš„æœåŠ¡

### 2. ä»æœ€æ—©ä½ç½®å¼€å§‹ï¼ˆStartFromEarliestï¼‰

æ¶ˆè´¹è€…ä¼šå¤„ç†Streamä¸­çš„**æ‰€æœ‰æ¶ˆæ¯**ï¼ŒåŒ…æ‹¬å†å²æ¶ˆæ¯å’Œæ–°æ¶ˆæ¯ã€‚

```go
mq := queue.NewMessageQueueWithStartPosition(rdb, "stream", "group", "consumer", queue.StartFromEarliest)
```

**é€‚ç”¨åœºæ™¯**ï¼š
- æ•°æ®è¿ç§»å’ŒåŒæ­¥
- éœ€è¦å¤„ç†å†å²æ•°æ®
- æ–°æ¶ˆè´¹è€…éœ€è¦è¿½èµ¶å†å²æ¶ˆæ¯
- æ•°æ®é‡æ”¾å’Œåˆ†æ

### 3. ä»æŒ‡å®šæ¶ˆæ¯IDå¼€å§‹ï¼ˆStartFromSpecificï¼‰

ä»æŒ‡å®šçš„æ¶ˆæ¯IDå¼€å§‹æ¶ˆè´¹ï¼Œå¯ä»¥ç²¾ç¡®æ§åˆ¶æ¶ˆè´¹èµ·ç‚¹ã€‚

```go
mq := queue.NewMessageQueueFromSpecificID(rdb, "stream", "group", "consumer", "1234567890-0")
```

**é€‚ç”¨åœºæ™¯**ï¼š
- ä»ç‰¹å®šæ—¶é—´ç‚¹å¼€å§‹å¤„ç†
- æ•…éšœæ¢å¤åä»æ–­ç‚¹ç»§ç»­
- éƒ¨åˆ†æ•°æ®é‡æ”¾

## ğŸ§ª å®é™…æ¼”ç¤º

### è¿è¡Œæ¼”ç¤ºç¨‹åº
```bash
# å¯åŠ¨Redis
make redis-up

# è¿è¡Œå¼€å§‹ä½ç½®æ¼”ç¤º
make demo-start-position

# è¿è¡Œæµ‹è¯•
make test-start-position
```

### æ¼”ç¤ºç»“æœå¯¹æ¯”

**ä»æœ€æ–°ä½ç½®å¼€å§‹**ï¼š
```
åˆ›å»ºæ¶ˆè´¹è€…ç»„ latest-groupï¼Œå¼€å§‹ä½ç½®: $
[æœ€æ–°ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173498054-0, å†…å®¹: map[index:100 message:æ–°æ¶ˆæ¯ 0]
[æœ€æ–°ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173498157-0, å†…å®¹: map[index:101 message:æ–°æ¶ˆæ¯ 1]
```
âœ… åªå¤„ç†äº†å¯åŠ¨åçš„æ–°æ¶ˆæ¯

**ä»æœ€æ—©ä½ç½®å¼€å§‹**ï¼š
```
åˆ›å»ºæ¶ˆè´¹è€…ç»„ earliest-groupï¼Œå¼€å§‹ä½ç½®: 0
[æœ€æ—©ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173495542-0, å†…å®¹: map[index:0 message:å†å²æ¶ˆæ¯ 0]
[æœ€æ—©ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173495644-0, å†…å®¹: map[index:1 message:å†å²æ¶ˆæ¯ 1]
[æœ€æ—©ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173495745-0, å†…å®¹: map[index:2 message:å†å²æ¶ˆæ¯ 2]
[æœ€æ—©ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173495847-0, å†…å®¹: map[index:3 message:å†å²æ¶ˆæ¯ 3]
[æœ€æ—©ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173495949-0, å†…å®¹: map[index:4 message:å†å²æ¶ˆæ¯ 4]
[æœ€æ—©ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173498054-0, å†…å®¹: map[index:100 message:æ–°æ¶ˆæ¯ 0]
[æœ€æ—©ä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173498157-0, å†…å®¹: map[index:101 message:æ–°æ¶ˆæ¯ 1]
```
âœ… å¤„ç†äº†æ‰€æœ‰å†å²æ¶ˆæ¯å’Œæ–°æ¶ˆæ¯

**ä»æŒ‡å®šIDå¼€å§‹**ï¼š
```
åˆ›å»ºæ¶ˆè´¹è€…ç»„ specific-groupï¼Œå¼€å§‹ä½ç½®: 1748173508427-0
[æŒ‡å®šä½ç½®æ¶ˆè´¹è€…] å¤„ç†æ¶ˆæ¯: 1748173508532-0, å†…å®¹: map[index:202 message:æŒ‡å®šä½ç½®æµ‹è¯•æ¶ˆæ¯ 2]
```
âœ… åªå¤„ç†äº†æŒ‡å®šIDä¹‹åçš„æ¶ˆæ¯

## âš™ï¸ æŠ€æœ¯å®ç°

### Redis Streamä½ç½®å‚æ•°

| å¼€å§‹ä½ç½® | Rediså‚æ•° | è¯´æ˜ |
|---------|-----------|------|
| StartFromLatest | `$` | ä»æœ€æ–°æ¶ˆæ¯å¼€å§‹ |
| StartFromEarliest | `0` | ä»æœ€æ—©æ¶ˆæ¯å¼€å§‹ |
| StartFromSpecific | `æ¶ˆæ¯ID` | ä»æŒ‡å®šæ¶ˆæ¯å¼€å§‹ |

### æ¶ˆè´¹è€…ç»„åˆ›å»º

```go
// åœ¨createConsumerGroupæ–¹æ³•ä¸­
var startID string
switch mq.startPos {
case StartFromLatest:
    startID = "$"
case StartFromEarliest:
    startID = "0"
case StartFromSpecific:
    startID = mq.specificID
}

err := mq.client.XGroupCreate(ctx, mq.streamName, mq.groupName, startID).Err()
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„å¼€å§‹ä½ç½®

- **ç”Ÿäº§ç¯å¢ƒæ–°æœåŠ¡**ï¼šä½¿ç”¨`StartFromLatest`é¿å…å¤„ç†å¤§é‡å†å²æ•°æ®
- **æ•°æ®åŒæ­¥æœåŠ¡**ï¼šä½¿ç”¨`StartFromEarliest`ç¡®ä¿ä¸é—æ¼æ•°æ®
- **æ•…éšœæ¢å¤**ï¼šä½¿ç”¨`StartFromSpecific`ä»æ–­ç‚¹ç»§ç»­

### 2. æ¶ˆè´¹è€…ç»„å‘½å

å»ºè®®åœ¨æ¶ˆè´¹è€…ç»„åç§°ä¸­ä½“ç°å¼€å§‹ä½ç½®ï¼š
```go
// å¥½çš„å‘½åç¤ºä¾‹
"email-processor-latest"
"data-sync-earliest" 
"recovery-from-specific"
```

### 3. ç›‘æ§å’Œæ—¥å¿—

ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•æ¶ˆè´¹è€…ç»„çš„åˆ›å»ºæ—¥å¿—ï¼š
```
åˆ›å»ºæ¶ˆè´¹è€…ç»„ earliest-groupï¼Œå¼€å§‹ä½ç½®: 0
```

### 4. æµ‹è¯•éªŒè¯

åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œå»ºè®®ï¼š
1. ä½¿ç”¨æµ‹è¯•æ•°æ®éªŒè¯å¼€å§‹ä½ç½®è¡Œä¸º
2. ç¡®è®¤æ¶ˆè´¹è€…å¤„ç†çš„æ¶ˆæ¯èŒƒå›´ç¬¦åˆé¢„æœŸ
3. æµ‹è¯•ä¸åŒåœºæ™¯ä¸‹çš„æ¶ˆè´¹è€…è¡Œä¸º

## ğŸš¨ æ³¨æ„äº‹é¡¹

### 1. æ¶ˆè´¹è€…ç»„å”¯ä¸€æ€§
- æ¯ä¸ªæ¶ˆè´¹è€…ç»„åªèƒ½æœ‰ä¸€ä¸ªå¼€å§‹ä½ç½®
- å¦‚æœæ¶ˆè´¹è€…ç»„å·²å­˜åœ¨ï¼Œå¼€å§‹ä½ç½®é…ç½®ä¼šè¢«å¿½ç•¥
- è¦æ”¹å˜å¼€å§‹ä½ç½®ï¼Œéœ€è¦åˆ é™¤ç°æœ‰æ¶ˆè´¹è€…ç»„

### 2. æ€§èƒ½è€ƒè™‘
- `StartFromEarliest`å¯èƒ½éœ€è¦å¤„ç†å¤§é‡å†å²æ•°æ®
- å»ºè®®åœ¨ä½å³°æœŸå¯åŠ¨ä»æœ€æ—©ä½ç½®å¼€å§‹çš„æ¶ˆè´¹è€…
- ç›‘æ§æ¶ˆè´¹è€…çš„å¤„ç†è¿›åº¦å’Œæ€§èƒ½

### 3. æ•°æ®ä¸€è‡´æ€§
- ç¡®ä¿æ¶ˆæ¯å¤„ç†çš„å¹‚ç­‰æ€§
- ä»æœ€æ—©ä½ç½®å¼€å§‹å¯èƒ½ä¼šé‡å¤å¤„ç†å·²å¤„ç†çš„æ¶ˆæ¯
- å®ç°é€‚å½“çš„å»é‡æœºåˆ¶

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ€»ä½“è¯´æ˜
- [ERROR_HANDLING.md](ERROR_HANDLING.md) - é”™è¯¯å¤„ç†æŒ‡å—
- [examples/start_position_demo.go](examples/start_position_demo.go) - å®Œæ•´æ¼”ç¤ºä»£ç 
- [tests/start_position_test.go](tests/start_position_test.go) - æµ‹è¯•ç”¨ä¾‹

## ğŸ”§ APIå‚è€ƒ

### æ„é€ å‡½æ•°

```go
// é»˜è®¤ä»æœ€æ–°ä½ç½®å¼€å§‹
func NewMessageQueue(client *redis.Client, streamName, groupName, consumerName string) *MessageQueue

// æŒ‡å®šå¼€å§‹ä½ç½®
func NewMessageQueueWithStartPosition(client *redis.Client, streamName, groupName, consumerName string, startPos StartPosition) *MessageQueue

// ä»æŒ‡å®šæ¶ˆæ¯IDå¼€å§‹
func NewMessageQueueFromSpecificID(client *redis.Client, streamName, groupName, consumerName string, messageID string) *MessageQueue
```

### å¼€å§‹ä½ç½®å¸¸é‡

```go
const (
    StartFromLatest   StartPosition = "$"        // ä»æœ€æ–°æ¶ˆæ¯å¼€å§‹
    StartFromEarliest StartPosition = "0"        // ä»æœ€æ—©æ¶ˆæ¯å¼€å§‹  
    StartFromSpecific StartPosition = "specific" // ä»æŒ‡å®šæ¶ˆæ¯å¼€å§‹
)
``` 